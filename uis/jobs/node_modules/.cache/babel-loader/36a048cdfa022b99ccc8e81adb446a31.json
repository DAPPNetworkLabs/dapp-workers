{"ast":null,"code":"import Web3 from 'web3';\nimport NexusJSON from '../../abi/Nexus.json';\nconst jobs = [];\nconst web3 = new Web3('http://localhost:8545');\nconst contractAddress = \"0x94D387F50569200aDACFd903345D077ef6ABcE11\";\nconst contract = new web3.eth.Contract(NexusJSON.abi, contractAddress);\nconst ethereum = window.ethereum;\n\nconst fetchJobs = async thisObject => {\n  console.log(contract);\n  const lastJob = await contract.methods.lastJobID().call();\n  console.log(`lastJob: ${lastJob}`);\n\n  for (let i = 0; i < lastJob; i++) {\n    const job = await contract.methods.jobs(i).call();\n    jobs.push(job);\n  }\n\n  console.log(`jobs: ${jobs}`);\n  thisObject.setState({\n    jobs: JSON.stringify(jobs)\n  });\n};\n\nconst runJob = async form => {\n  const job = await contract.methods.run(form.consumer, form.imageName, form.inputFS, form.args).call({\n    from: form.consumer\n  });\n  console.log(job);\n  const transactionParameters = {\n    nonce: '0x00',\n    gasPrice: '0x09184e72a000',\n    gasLimit: '0x01406F40',\n    gas: '0x2710',\n    to: contractAddress,\n    from: ethereum.selectedAddress,\n    value: '0x00',\n    data: '0x7f7465737432000000000000000000000000000000000000000000000000000000600057',\n    // Optional, but used for defining smart contract creation and interaction.\n    chainId: '0x3' // Used to prevent transaction reuse across blockchains. Auto-filled by MetaMask.\n\n  }; // txHash is a hex string\n  // As with any RPC call, it may throw an error\n\n  const txHash = await ethereum.request({\n    method: 'eth_sendTransaction',\n    params: [transactionParameters]\n  });\n  console.log(txHash); // await contract.events.Run({}, function(error, event){\n  //     console.log(error);\n  //     console.log(event); \n  // });\n};\n\nexport default {\n  fetchJobs,\n  runJob\n};","map":{"version":3,"sources":["/Users/natanaelprudhomme/Workspaces/dapp-workers/uis/jobs/src/lib/web3/index.js"],"names":["Web3","NexusJSON","jobs","web3","contractAddress","contract","eth","Contract","abi","ethereum","window","fetchJobs","thisObject","console","log","lastJob","methods","lastJobID","call","i","job","push","setState","JSON","stringify","runJob","form","run","consumer","imageName","inputFS","args","from","transactionParameters","nonce","gasPrice","gasLimit","gas","to","selectedAddress","value","data","chainId","txHash","request","method","params"],"mappings":"AAAA,OAAOA,IAAP,MAAiB,MAAjB;AACA,OAAOC,SAAP,MAAsB,sBAAtB;AAEA,MAAMC,IAAI,GAAG,EAAb;AACA,MAAMC,IAAI,GAAG,IAAIH,IAAJ,CAAS,uBAAT,CAAb;AACA,MAAMI,eAAe,GAAG,4CAAxB;AACA,MAAMC,QAAQ,GAAG,IAAIF,IAAI,CAACG,GAAL,CAASC,QAAb,CAAsBN,SAAS,CAACO,GAAhC,EAAoCJ,eAApC,CAAjB;AACA,MAAMK,QAAQ,GAAGC,MAAM,CAACD,QAAxB;;AAEA,MAAME,SAAS,GAAG,MAAOC,UAAP,IAAsB;AACpCC,EAAAA,OAAO,CAACC,GAAR,CAAYT,QAAZ;AACA,QAAMU,OAAO,GAAG,MAAMV,QAAQ,CAACW,OAAT,CAAiBC,SAAjB,GAA6BC,IAA7B,EAAtB;AACAL,EAAAA,OAAO,CAACC,GAAR,CAAa,YAAWC,OAAQ,EAAhC;;AACA,OAAI,IAAII,CAAC,GAAC,CAAV,EAAaA,CAAC,GAAGJ,OAAjB,EAA0BI,CAAC,EAA3B,EAA+B;AAC3B,UAAMC,GAAG,GAAG,MAAMf,QAAQ,CAACW,OAAT,CAAiBd,IAAjB,CAAsBiB,CAAtB,EAAyBD,IAAzB,EAAlB;AACAhB,IAAAA,IAAI,CAACmB,IAAL,CAAUD,GAAV;AACH;;AACDP,EAAAA,OAAO,CAACC,GAAR,CAAa,SAAQZ,IAAK,EAA1B;AACAU,EAAAA,UAAU,CAACU,QAAX,CAAoB;AAACpB,IAAAA,IAAI,EAAEqB,IAAI,CAACC,SAAL,CAAetB,IAAf;AAAP,GAApB;AACH,CAVD;;AAYA,MAAMuB,MAAM,GAAG,MAAOC,IAAP,IAAgB;AAC3B,QAAMN,GAAG,GAAG,MAAMf,QAAQ,CAACW,OAAT,CAAiBW,GAAjB,CAAqBD,IAAI,CAACE,QAA1B,EAAoCF,IAAI,CAACG,SAAzC,EAAoDH,IAAI,CAACI,OAAzD,EAAkEJ,IAAI,CAACK,IAAvE,EAA6Eb,IAA7E,CAAkF;AAChGc,IAAAA,IAAI,EAACN,IAAI,CAACE;AADsF,GAAlF,CAAlB;AAGAf,EAAAA,OAAO,CAACC,GAAR,CAAYM,GAAZ;AACA,QAAMa,qBAAqB,GAAG;AAC1BC,IAAAA,KAAK,EAAE,MADmB;AAE1BC,IAAAA,QAAQ,EAAE,gBAFgB;AAG1BC,IAAAA,QAAQ,EAAE,YAHgB;AAI1BC,IAAAA,GAAG,EAAE,QAJqB;AAK1BC,IAAAA,EAAE,EAAElC,eALsB;AAM1B4B,IAAAA,IAAI,EAAEvB,QAAQ,CAAC8B,eANW;AAO1BC,IAAAA,KAAK,EAAE,MAPmB;AAQ1BC,IAAAA,IAAI,EACA,4EATsB;AASwD;AAClFC,IAAAA,OAAO,EAAE,KAViB,CAUV;;AAVU,GAA9B,CAL2B,CAkB3B;AACA;;AACA,QAAMC,MAAM,GAAG,MAAMlC,QAAQ,CAACmC,OAAT,CAAiB;AAClCC,IAAAA,MAAM,EAAE,qBAD0B;AAElCC,IAAAA,MAAM,EAAE,CAACb,qBAAD;AAF0B,GAAjB,CAArB;AAIApB,EAAAA,OAAO,CAACC,GAAR,CAAY6B,MAAZ,EAxB2B,CAyB3B;AACA;AACA;AACA;AACH,CA7BD;;AA+BA,eAAe;AACXhC,EAAAA,SADW;AAEXc,EAAAA;AAFW,CAAf","sourcesContent":["import Web3 from 'web3';\nimport NexusJSON from '../../abi/Nexus.json';\n\nconst jobs = [];\nconst web3 = new Web3('http://localhost:8545');\nconst contractAddress = \"0x94D387F50569200aDACFd903345D077ef6ABcE11\";\nconst contract = new web3.eth.Contract(NexusJSON.abi,contractAddress);\nconst ethereum = window.ethereum;\n\nconst fetchJobs = async (thisObject) => {\n    console.log(contract);\n    const lastJob = await contract.methods.lastJobID().call();\n    console.log(`lastJob: ${lastJob}`);\n    for(let i=0; i < lastJob; i++) {\n        const job = await contract.methods.jobs(i).call();\n        jobs.push(job);\n    }\n    console.log(`jobs: ${jobs}`);\n    thisObject.setState({jobs: JSON.stringify(jobs)});\n}\n\nconst runJob = async (form) => {\n    const job = await contract.methods.run(form.consumer, form.imageName, form.inputFS, form.args).call({\n        from:form.consumer\n    });\n    console.log(job)\n    const transactionParameters = {\n        nonce: '0x00',\n        gasPrice: '0x09184e72a000',\n        gasLimit: '0x01406F40',\n        gas: '0x2710',\n        to: contractAddress,\n        from: ethereum.selectedAddress,\n        value: '0x00',\n        data:\n            '0x7f7465737432000000000000000000000000000000000000000000000000000000600057', // Optional, but used for defining smart contract creation and interaction.\n        chainId: '0x3', // Used to prevent transaction reuse across blockchains. Auto-filled by MetaMask.\n    };\n\n    // txHash is a hex string\n    // As with any RPC call, it may throw an error\n    const txHash = await ethereum.request({\n        method: 'eth_sendTransaction',\n        params: [transactionParameters],\n    });\n    console.log(txHash);\n    // await contract.events.Run({}, function(error, event){\n    //     console.log(error);\n    //     console.log(event); \n    // });\n}\n\nexport default { \n    fetchJobs,\n    runJob\n}"]},"metadata":{},"sourceType":"module"}