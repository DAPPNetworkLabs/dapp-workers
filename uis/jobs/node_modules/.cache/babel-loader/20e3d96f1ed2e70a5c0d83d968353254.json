{"ast":null,"code":"import Web3 from 'web3';\nimport NexusJSON from '../../abi/Nexus.json';\nconst jobs = []; // const provider = new Web3.providers.WebsocketProvider('ws://localhost:8545');\n// const web3 = new Web3(provider);\n\nconst web3 = new Web3('http://localhost:8545');\nconst contractAddress = \"0x94D387F50569200aDACFd903345D077ef6ABcE11\";\nconst contract = new web3.eth.Contract(NexusJSON.abi, contractAddress);\nconst ethereum = window.ethereum;\n\nconst returnAbi = func => {\n  return NexusJSON.abi.find(el => el.name == func && el.type == \"function\");\n};\n\nconst fetchJobs = async thisObject => {\n  console.log(contract);\n  const lastJob = await contract.methods.lastJobID().call();\n  console.log(`lastJob: ${lastJob}`);\n\n  for (let i = 0; i < lastJob; i++) {\n    const job = await contract.methods.jobs(i).call();\n    jobs.push(job);\n  }\n\n  console.log(`jobs: ${jobs}`);\n  thisObject.setState({\n    jobs: JSON.stringify(jobs)\n  });\n};\n\nconst runJob = async form => {\n  const abi = returnAbi(\"run\");\n  const data = web3.eth.abi.encodeFunctionCall(abi, [form.consumer, form.imageName, form.inputFS, form.args]);\n  const transactionParameters = {\n    nonce: '0x00',\n    gasPrice: '2000000000',\n    gasLimit: '21000',\n    to: contractAddress,\n    from: ethereum.selectedAddress,\n    value: '0x00',\n    data,\n    chainId: '0x3' // Used to prevent transaction reuse across blockchains. Auto-filled by MetaMask.\n\n  };\n  const txHash = await ethereum.request({\n    method: 'eth_sendTransaction',\n    params: [transactionParameters]\n  });\n  console.log(`trx: ${txHash}`); // await contract.events.Run({}, function(error, event){\n  //     console.log(error);\n  //     console.log(event); \n  // });\n};\n\nexport default {\n  fetchJobs,\n  runJob\n};","map":{"version":3,"sources":["/Users/natanaelprudhomme/Workspaces/dapp-workers/uis/jobs/src/lib/web3/index.js"],"names":["Web3","NexusJSON","jobs","web3","contractAddress","contract","eth","Contract","abi","ethereum","window","returnAbi","func","find","el","name","type","fetchJobs","thisObject","console","log","lastJob","methods","lastJobID","call","i","job","push","setState","JSON","stringify","runJob","form","data","encodeFunctionCall","consumer","imageName","inputFS","args","transactionParameters","nonce","gasPrice","gasLimit","to","from","selectedAddress","value","chainId","txHash","request","method","params"],"mappings":"AAAA,OAAOA,IAAP,MAAiB,MAAjB;AACA,OAAOC,SAAP,MAAsB,sBAAtB;AAEA,MAAMC,IAAI,GAAG,EAAb,C,CACA;AACA;;AACA,MAAMC,IAAI,GAAG,IAAIH,IAAJ,CAAS,uBAAT,CAAb;AACA,MAAMI,eAAe,GAAG,4CAAxB;AACA,MAAMC,QAAQ,GAAG,IAAIF,IAAI,CAACG,GAAL,CAASC,QAAb,CAAsBN,SAAS,CAACO,GAAhC,EAAoCJ,eAApC,CAAjB;AACA,MAAMK,QAAQ,GAAGC,MAAM,CAACD,QAAxB;;AAEA,MAAME,SAAS,GAAIC,IAAD,IAAU;AACxB,SAAOX,SAAS,CAACO,GAAV,CAAcK,IAAd,CAAmBC,EAAE,IAAIA,EAAE,CAACC,IAAH,IAAWH,IAAX,IAAmBE,EAAE,CAACE,IAAH,IAAW,UAAvD,CAAP;AACH,CAFD;;AAIA,MAAMC,SAAS,GAAG,MAAOC,UAAP,IAAsB;AACpCC,EAAAA,OAAO,CAACC,GAAR,CAAYf,QAAZ;AACA,QAAMgB,OAAO,GAAG,MAAMhB,QAAQ,CAACiB,OAAT,CAAiBC,SAAjB,GAA6BC,IAA7B,EAAtB;AACAL,EAAAA,OAAO,CAACC,GAAR,CAAa,YAAWC,OAAQ,EAAhC;;AACA,OAAI,IAAII,CAAC,GAAC,CAAV,EAAaA,CAAC,GAAGJ,OAAjB,EAA0BI,CAAC,EAA3B,EAA+B;AAC3B,UAAMC,GAAG,GAAG,MAAMrB,QAAQ,CAACiB,OAAT,CAAiBpB,IAAjB,CAAsBuB,CAAtB,EAAyBD,IAAzB,EAAlB;AACAtB,IAAAA,IAAI,CAACyB,IAAL,CAAUD,GAAV;AACH;;AACDP,EAAAA,OAAO,CAACC,GAAR,CAAa,SAAQlB,IAAK,EAA1B;AACAgB,EAAAA,UAAU,CAACU,QAAX,CAAoB;AAAC1B,IAAAA,IAAI,EAAE2B,IAAI,CAACC,SAAL,CAAe5B,IAAf;AAAP,GAApB;AACH,CAVD;;AAYA,MAAM6B,MAAM,GAAG,MAAOC,IAAP,IAAgB;AAC3B,QAAMxB,GAAG,GAAGG,SAAS,CAAC,KAAD,CAArB;AACA,QAAMsB,IAAI,GAAG9B,IAAI,CAACG,GAAL,CAASE,GAAT,CAAa0B,kBAAb,CAAgC1B,GAAhC,EAAqC,CAC9CwB,IAAI,CAACG,QADyC,EAE9CH,IAAI,CAACI,SAFyC,EAG9CJ,IAAI,CAACK,OAHyC,EAGjCL,IAAI,CAACM,IAH4B,CAArC,CAAb;AAKA,QAAMC,qBAAqB,GAAG;AAC1BC,IAAAA,KAAK,EAAE,MADmB;AAE1BC,IAAAA,QAAQ,EAAE,YAFgB;AAG1BC,IAAAA,QAAQ,EAAE,OAHgB;AAI1BC,IAAAA,EAAE,EAAEvC,eAJsB;AAK1BwC,IAAAA,IAAI,EAAEnC,QAAQ,CAACoC,eALW;AAM1BC,IAAAA,KAAK,EAAE,MANmB;AAO1Bb,IAAAA,IAP0B;AAQ1Bc,IAAAA,OAAO,EAAE,KARiB,CAQV;;AARU,GAA9B;AAWA,QAAMC,MAAM,GAAG,MAAMvC,QAAQ,CAACwC,OAAT,CAAiB;AAClCC,IAAAA,MAAM,EAAE,qBAD0B;AAElCC,IAAAA,MAAM,EAAE,CAACZ,qBAAD;AAF0B,GAAjB,CAArB;AAIApB,EAAAA,OAAO,CAACC,GAAR,CAAa,QAAO4B,MAAO,EAA3B,EAtB2B,CAuB3B;AACA;AACA;AACA;AACH,CA3BD;;AA6BA,eAAe;AACX/B,EAAAA,SADW;AAEXc,EAAAA;AAFW,CAAf","sourcesContent":["import Web3 from 'web3';\nimport NexusJSON from '../../abi/Nexus.json';\n\nconst jobs = [];\n// const provider = new Web3.providers.WebsocketProvider('ws://localhost:8545');\n// const web3 = new Web3(provider);\nconst web3 = new Web3('http://localhost:8545');\nconst contractAddress = \"0x94D387F50569200aDACFd903345D077ef6ABcE11\";\nconst contract = new web3.eth.Contract(NexusJSON.abi,contractAddress);\nconst ethereum = window.ethereum;\n\nconst returnAbi = (func) => {\n    return NexusJSON.abi.find(el => el.name == func && el.type == \"function\");\n}\n\nconst fetchJobs = async (thisObject) => {\n    console.log(contract);\n    const lastJob = await contract.methods.lastJobID().call();\n    console.log(`lastJob: ${lastJob}`);\n    for(let i=0; i < lastJob; i++) {\n        const job = await contract.methods.jobs(i).call();\n        jobs.push(job);\n    }\n    console.log(`jobs: ${jobs}`);\n    thisObject.setState({jobs: JSON.stringify(jobs)});\n}\n\nconst runJob = async (form) => {\n    const abi = returnAbi(\"run\");\n    const data = web3.eth.abi.encodeFunctionCall(abi, [\n        form.consumer,\n        form.imageName,\n        form.inputFS,form.args\n    ]);\n    const transactionParameters = {\n        nonce: '0x00',\n        gasPrice: '2000000000',\n        gasLimit: '21000',\n        to: contractAddress,\n        from: ethereum.selectedAddress,\n        value: '0x00',\n        data,\n        chainId: '0x3', // Used to prevent transaction reuse across blockchains. Auto-filled by MetaMask.\n    };\n\n    const txHash = await ethereum.request({\n        method: 'eth_sendTransaction',\n        params: [transactionParameters],\n    });\n    console.log(`trx: ${txHash}`);\n    // await contract.events.Run({}, function(error, event){\n    //     console.log(error);\n    //     console.log(event); \n    // });\n}\n\nexport default { \n    fetchJobs,\n    runJob\n}"]},"metadata":{},"sourceType":"module"}